# Redis & Celery Integration Guide

## üöÄ –û–±–∑–æ—Ä

–í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç:
- **Redis** –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –±—Ä–æ–∫–µ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- **Celery** –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
- **Flower** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Celery

## üõ†Ô∏è –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üìä –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (Redis)
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (5 –º–∏–Ω—É—Ç)
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á (5 –º–∏–Ω—É—Ç)
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (1 —á–∞—Å)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

### üîÑ –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (Celery)
- **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–¥–∞—á–∞—Ö** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ –¥–µ–Ω—å –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞—á** - —Ñ–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á** - –∫–∞–∂–¥—ã–π —á–∞—Å
- **–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞** - —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–¥–∞—á** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –≤ JSON
- **–ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–¥–∞—á –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

## üê≥ –ó–∞–ø—É—Å–∫ —Å Docker

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –¢–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (–±–µ–∑ Flower)
docker-compose up -d app db redis celery-worker celery-beat
```

## üíª –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install -r requirements.txt
```

### 2. –ó–∞–ø—É—Å–∫ Redis (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Docker)
```bash
redis-server
```

### 3. –ó–∞–ø—É—Å–∫ Celery Worker
```bash
celery -A src.celery_app worker --loglevel=info
```

### 4. –ó–∞–ø—É—Å–∫ Celery Beat (–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫)
```bash
celery -A src.celery_app beat --loglevel=info
```

### 5. –ó–∞–ø—É—Å–∫ Flower (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
```bash
celery -A src.celery_app flower --port=5555
```

### 6. –ó–∞–ø—É—Å–∫ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
uvicorn src.main:app --reload
```

## üåê –î–æ—Å—Ç—É–ø–Ω—ã–µ URL

- **API**: http://localhost:8000
- **API Docs**: http://localhost:8000/docs
- **Flower (Celery Monitor)**: http://localhost:5555
- **Health Check**: http://localhost:8000/health
- **Cache Status**: http://localhost:8000/cache/status

## üìä –ù–æ–≤—ã–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞—á
```http
GET /tasks/statistics
```

### –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–¥–∞—á
```http
POST /tasks/export?export_format=json
```

### –°—Ç–∞—Ç—É—Å —ç–∫—Å–ø–æ—Ä—Ç–∞
```http
GET /tasks/export-status/{task_id}
```

### –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```http
POST /tasks/bulk-update
Content-Type: application/json

{
  "task_ids": [1, 2, 3],
  "update_data": {"completed": true}
}
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# Redis
REDIS_URL=redis://localhost:6379/0

# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Docker
REDIS_URL=redis://redis:6379/0
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
–í `src/config.py`:
```python
cache_ttl: int = 300  # 5 –º–∏–Ω—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

## üìã Celery –∑–∞–¥–∞—á–∏

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–¥–∞—á–∏:
1. `send_task_reminder` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
2. `process_task_statistics` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
3. `check_overdue_tasks` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
4. `daily_cleanup` - –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
5. `export_user_tasks` - —ç–∫—Å–ø–æ—Ä—Ç –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
6. `bulk_update_tasks` - –º–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ (Celery Beat):
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á**: –∫–∞–∂–¥—ã–π —á–∞—Å
- **–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞**: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Flower Dashboard
–û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5555 –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
- –ê–∫—Ç–∏–≤–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã
- –í—ã–ø–æ–ª–Ω—è—é—â–∏–µ—Å—è –∑–∞–¥–∞—á–∏
- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–¥–∞—á
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### Health Check
```http
GET /health
```
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ Redis.

### Cache Status
```http
GET /cache/status  
```
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è.

## üö® –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º
```python
# –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á–∏ —Å –¥–µ–¥–ª–∞–π–Ω–æ–º —á–µ—Ä–µ–∑ API
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ –¥–µ–Ω—å –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞
```

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∑–∞–¥–∞—á
```python
from src.tasks.celery_tasks import process_task_statistics

# –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
process_task_statistics.delay()
```

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ
```python
from src.redis_client import redis_client

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫–µ—à
await redis_client.set("my_key", {"data": "value"}, ttl=300)

# –ü–æ–ª—É—á–∏—Ç—å –∏–∑ –∫–µ—à–∞
data = await redis_client.get("my_key")
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:
1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è Redis
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
3. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ Flower
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ CORS –ø–æ–ª–∏—Ç–∏–∫–∏

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å Redis
```bash
redis-cli ping
```

### –õ–æ–≥–∏ Celery Worker
```bash
celery -A src.celery_app worker --loglevel=debug
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á
```bash
redis-cli
> LLEN celery
> LRANGE celery 0 -1
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **Redis –∫–µ—à** –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä—è–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á
- **–§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏** –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç API –∑–∞–ø—Ä–æ—Å—ã
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–¢–µ–ø–µ—Ä—å –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –≤—ã—Å–æ–∫–∏–º –Ω–∞–≥—Ä—É–∑–∫–∞–º! üéâ 