[build]
builder = "dockerfile"

[[services]]
name = "api"
[services.build]
dockerfile = "Dockerfile"
[services.deploy]
startCommand = "uvicorn src.main:app --host 0.0.0.0 --port $PORT"
healthcheckPath = "/health"
healthcheckTimeout = 100
restartPolicyType = "ON_FAILURE"

[[services]]
name = "celery-worker"
[services.build]
dockerfile = "Dockerfile.worker"
[services.deploy]
startCommand = "celery -A src.celery_app worker --loglevel=info"
restartPolicyType = "ON_FAILURE"

[[services]]
name = "celery-beat"
[services.build]
dockerfile = "Dockerfile.worker"
[services.deploy]
startCommand = "celery -A src.celery_app beat --loglevel=info"
restartPolicyType = "ON_FAILURE"

[[services]]
name = "redis"
[services.image]
name = "redis:7-alpine" 